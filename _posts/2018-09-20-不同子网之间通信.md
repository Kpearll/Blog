---
layout:     post
title:      不同子网之间通信
subtitle:   
date:       2018-09-20
author:     Kpearl
header-img: img/network-bg1.jpg
catalog: true
tags:
    - 计算机网络
---

### 不同子网之间通信
#### 问题：
```
    两台服务器A和B的网络配置如下图，B的子网掩码本应该是255.255.255.0，被不小心配成了255.255.255.224。则它们还能正常通信吗？
```
![](https://kpearl.cn/img/posts-img/2018092001/1.png)
#### 拓扑图如下：
![](https://kpearl.cn/img/posts-img/2018092001/2.png)
#### 使用Wireshark软件分析网络包，在主机B上进行抓包如下图：
![](https://kpearl.cn/img/posts-img/2018092001/3.png)
#### 分析：
1. 当使用主机B ping 主机A时主机B首先进行ARP广播询问192.168.26.129的MAC地址，根据子网掩码判断主机A和主机B不在同一子网内，所以将数据包发送至默认网关，网关将自己的MAC地址回复给主机B。
2. 主机B再次ping主机A，主机B直接将数据包发送给网关，然后网关进行ARP广播询问192.168.26.129的MAC地址，回复给网关。
3. 主机B再次ping主机A，数据包发送至网关，由于网关知道主机A的MAC地址，所以网关将数据包转发给主机A，主机A收到数据包后询问192.168.26.3的MAC地址是多少，主机B将它的MAC地址回复给主机A，这时主机A已经知道主机B的MAC地址，对于主机A来说和主机B属于同一子网所以不需要经过网关，直接将数据包发送给主机B。

##### 总结：主机B先把ping请求发送给默认网关，然后默认网关在转发给主机A，而主机A收到请求后直接把ping回复给主机B，形成三角环路。
##### 同一子网内通信不需要网关，只需要在子网内ARP广播询问MAC地址即可，不同子网需要使用网关进行通信。
